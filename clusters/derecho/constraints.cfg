#
#   constraints.cfg
#
#   This file is used to add (a) externals and (b) "constraints" (require/prefer) statements
#   for packages. While both of these actions can be accomplished via other means, there are
#   multiple reasons to have this script:
#
#       1.  Spack external detection is not implemented for many packages
#       2.  We use prefer/require statements to ensure that the majority of packages are
#           compiled using the core GCC, rather than recompiling them using matrixed
#           compilers, many of which have issues compiling a wide range of packages. With
#           this script it is easy to impose such requirements quickly.
#       3.  This script is used for all cluster types, and so it is easy to keep
#           specifications uniform across them.
#   
#   Last Revised:   14:43, 15 Dec 2025
#

externals: type=compiler buildable=no {
    /glade/u/apps/common/25.10/spack/opt/spack/[gcc/*]/*
}

externals: gpu=cuda type=compiler buildable=no {
    /glade/u/apps/casper/24.12/spack/opt/spack/[intel-oneapi-compilers/2024.*]/gcc/*/*
    /glade/u/apps/common/25.10/spack/opt/spack/[intel-oneapi-compilers/*]/*
    /glade/u/apps/casper/24.12/spack/opt/spack/[nvhpc/25.9]/gcc/*/*
}

externals: buildable=no {
    gcc lustre pkg-config openssl
    #/glade/u/apps/opt/[matlab/R2024*]
    #/glade/u/apps/opt/[idl/9.*]
    #/glade/u/apps/opt/[rstudio/*]
    /glade/u/apps/opt/[ncl/6.6.2]
    /glade/u/apps/common/25.10/spack/opt/spack/[linaro-forge/*]/*
}

externals: gpu=cuda buildable=no {
    /glade/u/apps/common/25.10/spack/opt/spack/[intel-oneapi-vtune/*]/*/*/*
    /glade/u/apps/common/25.10/spack/opt/spack/[intel-oneapi-advisor/*]/*/*/*
    /glade/u/apps/common/25.10/spack/opt/spack/[cuda/*]/*
    /glade/u/apps/common/25.10/spack/opt/spack/[cudnn/*]/*
}

externals: host=casper buildable=no {
    opengl
}

externals: host=derecho,gust buildable=no {
    /opt/cray/[libfabric/1.*]
    /opt/cray/pe/[cce/19*]
    #/glade/u/apps/opt/[chapel/*]/hpe-cray-ex
    #/glade/u/apps/opt/[libtorch/*]
}

externals: gpu=rocm type=compiler buildable=no {
    /glade/u/apps/common/25.10/spack/opt/spack/[aocc/*]/*
}

#externals: gpu=rocm buildable=no prefix=/glade/u/apps/opt/rocm/rocm-6.4.3/llvm version=6.4.3 scope=rocm {
#    llvm-amdgpu
#    rocm-openmp-extras
#}

externals: gpu=rocm buildable=no prefix=/glade/u/apps/opt/rocm/rocm-6.4.3 version=6.4.3 scope=rocm {
    amdsmi
    comgr
    hip
    hipblas
    hipcc
    hipcub
    hipfort
    hiprand
    hipify-clang
    hsa-rocr-dev
    rccl
    rocblas
    rocfft
    rocm-core
    rocm-examples
    rocm-gdb
    rocm-smi-lib
    rocminfo
    rocprim
    rocprofiler-compute
    rocprofiler-systems
    rocprofiler-register
    rocrand
    rocsparse
    rocthrust
    roctracer-dev
}

# General note: It is easier to set package preferences than requirements
#               because if the package does not depend on a compiler, the
#               requirement will fail.
# TODO: Using the conditional syntax in the future makes sense. (or adding
#       some sort of compiler detection method in add_constraints)
prefer: core {
    antlr
    apptainer
    arrow
    assimp
    attr
    automake
    bash
    berkeley-db
    bison
    bzip2
    c-blosc2
    cairo
    cdo
    charliecloud
    cmake
    cmor
    cpio
    curl
    darshan-util
    dbus
    diffutils
    doxygen
    dsfmt
    ecbuild
    ecflow
    eigen
    elfutils
    emacs
    expat
    ferret
    findutils
    flatbuffers
    flex
    fltk
    fmt
    fontconfig
    freetype
    gawk
    gdb
    gdbm
    gettext
    ghostscript
    giflib
    git
    gl2ps
    glew
    glpk
    gmp
    gmt
    gnuplot
    gnutls
    go
    googletest
    grads
    graphicsmagick
    graphite2
    grep
    grib-util
    groff
    gtkplus
    gzip
    harfbuzz
    heaptrack
    help2man
    icu4c
    intel-oneapi-advisor
    intel-oneapi-compilers
    intel-oneapi-vtune
    jasper
    jq
    json-c
    jsoncpp
    krb5
    lcov
    lerc
    libaec
    libarchive
    libblastrampoline
    libcap
    libcerf
    libdeflate
    libepoxy
    libevent
    libffi
    libfuse
    libgd
    libgeotiff
    libgit2
    libibn2
    libiconv
    libjpeg
    libjpeg-turbo
    libogg
    libpaper
    libpciaccess
    libpng
    librsvg
    libseccomp
    libsigsegv
    libslirp
    libssh2
    libszip
    libtheora
    libtiff
    libtirpc
    libtool
    libtree
    libunwind
    libuv
    libwebp
    libwhich
    libxaw
    libxcb
    libx11
    libxcrypt
    libxft
    libyaml
    libzip
    llvm
    lmod
    lua
    lwgrp
    lz4
    lzo
    m4
    madis
    maven
    mbedtls
    mesa-glu
    mgard
    motif
    mpc
    mpfr
    muparser
    nano
    nasm
    nccmp
    nco
    ncurses
    ncview
    ncvis
    neovim
    nghttp2
    ninja
    npm
    nvhpc
    nvtop
    openjdk
    openjpeg
    openlibm
    openpbs
    openssh
    osmesa
    p7zip
    pango
    patchelf
    pcre
    pcre2
    peak-memusage
    pegtl
    perl
    pmix
    podman
    protobuf
    py-cython
    py-fypp
    py-meson-python
    py-numexpr
    py-pandas
    python
    qhull
    qt
    rapidjson
    readline
    ripgrep
    rsync
    ruby
    rust
    sed
    slirp4netns
    snappy
    source-highlight
    sqlite
    squashfs
    squashfuse
    sz
    tar
    tcl
    teckit
    texinfo
    texlive
    tk
    tmux
    tree
    unzip
    utf8proc
    util-linux-uuid
    vim
    vtk
    vtk-m
    wget
    wgrib2
    which
    xnedit
    xsimd
    xxd-standalone
    xxdiff
    xz
    zfp
    zlib
    zlib-ng
    zstd
    zziplib
}

require: core {
    gmake
    hwloc
    numactl
}

require: host=casper core {
    ucx
}
