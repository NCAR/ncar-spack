#!/bin/bash

if [[ -z $SPACK_PYDIR ]]; then
    SPACK_PYDIR=$INSTALLPATH_ROOT/python/3.7.9/gnu/9.1.0/bin
    SPACK_STARTUP=$(readlink -f $(dirname $(which spack))/../share/spack/setup-env.sh)
fi

if [[ -f $CUSTOM_SPACK_ROOT/bin/spack ]]; then
    SPACK_STARTUP=$CUSTOM_SPACK_ROOT/share/spack/setup-env.sh
fi

if [[ $0 == *tcsh ]]; then
    SPACK_STARTUP=${SPACK_STARTUP/%.sh/.csh}
    SHELL_INIT="/bin/tcsh -f"

    echo "To init Spack, run:"
    echo "    source \$SPACK_STARTUP"
    echo
else
    SHELL_INIT="/bin/bash --noprofile --rcfile $SPACK_STARTUP"
fi

exec env -i USER=$USER SUDO_USER=$SUDO_USER HOME=$HOME TERM=$TERM PATH=$SPACK_PYDIR:/usr/local/bin:/usr/bin:/bin TMPDIR=$TMPDIR SPACK_DISABLE_LOCAL_CONFIG=true NCAR_SPACK_CLEAN=$NCAR_SPACK_CLEAN SPACK_PYDIR=$SPACK_PYDIR SPACK_STARTUP=$SPACK_STARTUP $SHELL_INIT "$@"
